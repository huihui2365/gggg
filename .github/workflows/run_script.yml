name: Run Python Script

on:
  workflow_dispatch:  # 只允许手动触发工作流

jobs:
  run:
    runs-on: ubuntu-latest  # 选择运行的操作系统，通常选 Ubuntu

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3  # Checkout 仓库代码

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'  # 设置 Python 版本

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4  # 安装必要的依赖

    - name: Pull the latest changes
      run: |
        git pull origin main --rebase  # 修改为拉取远程的 main 分支并 rebase，避免冲突

    - name: Run the script (info only)
      run: |
        python -u py/merge_script.py  # 运行脚本并确保实时输出

    - name: Commit and push result files to GitHub
      run: |
        git config --global user.name "github-actions"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git add test/output/detail_result.json  # 将文件添加到 Git 跟踪
        git commit -m "Update detail_result.json" || echo "No changes to commit"
        git push

    - name: Upload results as artifacts
      uses: actions/upload-artifact@v4
      with:
        name: script-results
        path: test/output/detail_result.json  # 上传抓取的 JSON 结果文件
